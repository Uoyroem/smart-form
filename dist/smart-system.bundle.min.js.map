{"version":3,"file":"smart-system.bundle.min.js","mappings":"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","sources":["webpack://SmartSystem/webpack/bootstrap","webpack://SmartSystem/webpack/runtime/define property getters","webpack://SmartSystem/webpack/runtime/hasOwnProperty shorthand","webpack://SmartSystem/webpack/runtime/make namespace object","webpack://SmartSystem/./lib/core/dependency-graph.ts","webpack://SmartSystem/./lib/core/effect-manager.ts","webpack://SmartSystem/./lib/core/form.ts","webpack://SmartSystem/./lib/core/table.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export class DependencyGraph<Key = string> {\r\n    private _keys: Set<Key>;\r\n    private _dependentMap: Map<Key, Set<Key>>;\r\n    private _dependencyMap: Map<Key, Set<Key>>;\r\n    private _addedDependencies: [Key, Key][];\r\n    private _topologicalOrder: Key[];\r\n\r\n    constructor() {\r\n        this._keys = new Set<Key>();\r\n        this._dependentMap = new Map();\r\n        this._dependencyMap = new Map();\r\n        this._addedDependencies = [];\r\n        this._topologicalOrder = [];\r\n    }\r\n\r\n    getDependencies(): readonly [Key, Key][] {\r\n        return this._addedDependencies;\r\n    }\r\n\r\n    buildDependenciesMap(): void {\r\n        this._dependentMap = new Map();\r\n        this._dependencyMap = new Map();\r\n        this._keys = new Set();\r\n        this._topologicalOrder = [];\r\n\r\n        const dependencies = this.getDependencies();\r\n\r\n        for (const [dependent, dependency] of dependencies) {\r\n            this._keys.add(dependent);\r\n            this._keys.add(dependency);\r\n            if (!this._dependentMap.has(dependent)) {\r\n                this._dependentMap.set(dependent, new Set());\r\n            }\r\n            if (!this._dependentMap.has(dependency)) {\r\n                this._dependentMap.set(dependency, new Set());\r\n            }\r\n            if (!this._dependencyMap.has(dependent)) {\r\n                this._dependencyMap.set(dependent, new Set());\r\n            }\r\n            if (!this._dependencyMap.has(dependency)) {\r\n                this._dependencyMap.set(dependency, new Set());\r\n            }\r\n            this._dependentMap.get(dependent)!.add(dependency);\r\n            this._dependencyMap.get(dependency)!.add(dependent);\r\n        }\r\n        const inDegree = new Map();\r\n        for (const [dependent, dependencies] of this._dependentMap) {\r\n            inDegree.set(dependent, dependencies.size);\r\n        }\r\n        const queue: Key[] = [];\r\n        for (const [dependent, degree] of inDegree) {\r\n            if (degree === 0) {\r\n                queue.push(dependent);\r\n            }\r\n        }\r\n        while (queue.length > 0) {\r\n            const key = queue.shift()!;\r\n            this._topologicalOrder.push(key);\r\n            for (const dependency of this._dependencyMap.get(key)!) {\r\n                inDegree.set(dependency, inDegree.get(dependency) - 1);\r\n                if (inDegree.get(dependency) === 0) {\r\n                    queue.push(dependency);\r\n                }\r\n            }\r\n        }\r\n        if (this._topologicalOrder.length !== this._keys.size) {\r\n            throw new Error(\"There are cyclic dependencies\");\r\n        }\r\n    }\r\n\r\n    addDependency(dependent: Key, dependency: Key): void {\r\n        this._addedDependencies.push([dependent, dependency]);\r\n    }\r\n\r\n    get keys(): ReadonlySet<Key> {\r\n        return this._keys;\r\n    }\r\n\r\n    get topologicalOrder(): readonly Key[] {\r\n        return this._topologicalOrder;\r\n    }\r\n\r\n    get dependentMap(): ReadonlyMap<Key, ReadonlySet<Key>> {\r\n        return this._dependentMap;\r\n    }\r\n\r\n    get dependencyMap(): ReadonlyMap<Key, ReadonlySet<Key>> {\r\n        return this._dependencyMap;\r\n    }\r\n}","import { DependencyGraph } from \"./dependency-graph\";\r\n\r\nexport interface Effect {\r\n    type: string;\r\n    callback: () => Promise<Set<string>> | Set<string>;\r\n    dependsOn: string[];\r\n}\r\n\r\nexport class EffectManager extends DependencyGraph {\r\n    private _keyEffect: Map<string, Effect> = new Map();\r\n\r\n    constructor() {\r\n        super();\r\n        this._keyEffect = new Map();\r\n    }\r\n\r\n    override getDependencies(): readonly [string, string][] {\r\n        const dependencies: [string, string][] = [];\r\n        for (const [key, effect] of this._keyEffect) {\r\n            for (const dependency of effect.dependsOn) {\r\n                dependencies.push([key, dependency])\r\n            }\r\n        }\r\n        return super.getDependencies().concat(dependencies);\r\n    }\r\n\r\n    addEffect(key: string, effect: Effect) {\r\n        this._keyEffect.set(key, effect)\r\n    }\r\n\r\n    async triggerEffects({ changedNames = null }: { changedNames?: Set<string> | null } = {}) {\r\n        for (const name of this.topologicalOrder) {\r\n            if (changedNames != null && this.dependentMap.get(name)!.intersection(changedNames).size === 0) {\r\n                continue;\r\n            }\r\n            const effect = this._keyEffect.get(name);\r\n            if (effect != null) {\r\n                const changedNamesByEffect = await effect.callback();\r\n                if (changedNames) {\r\n                    changedNamesByEffect.forEach(changedName => { changedNames.add(changedName); });\r\n                }\r\n            } else {\r\n                if (changedNames) {\r\n                    changedNames.add(name);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import { EffectManager } from \"./effect-manager\";\r\nexport { EffectManager };\r\n\r\nfunction deepEqual(a: any, b: any): boolean {\r\n    if (a === b) return true;\r\n\r\n    if (typeof a !== \"object\" || typeof b !== \"object\" || a === null || b === null) {\r\n        return false;\r\n    }\r\n\r\n    const aKeys = new Set(Object.keys(a));\r\n    const bKeys = new Set(Object.keys(b));\r\n\r\n    if (aKeys.size !== bKeys.size) return false;\r\n    for (const key of aKeys) {\r\n        if (!deepEqual(a[key], b[key])) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nexport function getMetaDependencyKey(fieldName: string, metaKey: string) {\r\n    return `${fieldName}:${metaKey}`;\r\n}\r\n\r\n\r\n\r\nexport class FormFieldValidator {\r\n    public name: string;\r\n\r\n    constructor(name: string) {\r\n        this.name = name;\r\n    }\r\n\r\n    validate(field: FormField) {\r\n\r\n    }\r\n}\r\n\r\nexport class FormFieldValidatorRequired extends FormFieldValidator {\r\n    constructor() {\r\n        super(\"Required\");\r\n    }\r\n\r\n    validate(field: FormField): void {\r\n\r\n    }\r\n}\r\n\r\nexport type FormElement = HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement;\r\n\r\nexport enum FormFieldTypeElementStatus {\r\n    VALUE_SUCCESSFULLY_RECEIVED = \"value-successfully-received\",\r\n    VALUE_SET_SUCCESS = \"value-set-success\",\r\n    META_VALUE_SUCCESSFULLY_RECEIVED = \"meta-value-successfully-received\",\r\n    META_VALUE_SET_SUCCESS = \"meta-value-set-success\",\r\n    FAILED_TO_SET_VALUE = \"failed-to-set-value\",\r\n    FAILED_TO_SET_META_VALUE = \"failed-to-set-meta-value\",\r\n    INVALID_ELEMENT = \"invalid-element\",\r\n    TYPE_MISMATCH = \"type-mismatch\",\r\n    META_KEY_NOT_EXISTS = \"meta-key-not-exists\"\r\n}\r\n\r\nexport class FormFieldType {\r\n    static object() {\r\n        return new FormFieldTypeObject();\r\n    }\r\n\r\n    static text() {\r\n        return new FormFieldTypeText();\r\n    }\r\n\r\n    static number() {\r\n        return new FormFieldTypeNumber();\r\n    }\r\n\r\n    static date() {\r\n        return new FormFieldTypeDate();\r\n    }\r\n\r\n    static select({ multiple = false } = {}) {\r\n        return new FormFieldTypeSelect().multiple(multiple);\r\n    }\r\n\r\n    static checkbox() {\r\n        return new FormFieldTypeCheckbox();\r\n    }\r\n\r\n    static radio() {\r\n        return new FormFieldTypeRadio();\r\n    }\r\n\r\n    static isFormElement(element: Element): element is FormElement {\r\n        return element instanceof HTMLInputElement || element instanceof HTMLSelectElement || element instanceof HTMLTextAreaElement;\r\n    }\r\n\r\n    static fromFormElement(element: FormElement): FormFieldType {\r\n        switch (element.type) {\r\n            case \"select-one\":\r\n                return this.select();\r\n            case \"select-multiple\":\r\n                return this.select().multiple();\r\n            case \"number\":\r\n                return this.number();\r\n            case \"text\":\r\n                return this.text();\r\n            case \"textarea\":\r\n                return this.text().area();\r\n            case \"checkbox\":\r\n                return this.checkbox();\r\n            case \"radio\":\r\n                return this.radio();\r\n            case \"date\":\r\n                return this.date();\r\n            default:\r\n                throw new Error(`As element type ${element} not has`);\r\n        }\r\n    }\r\n\r\n    public name: string;\r\n\r\n    constructor(name: string) {\r\n        this.name = name;\r\n    }\r\n\r\n    isEqual(a: any, b: any): boolean { return a === b; }\r\n    isEmpty() { }\r\n    asElementType() { return \"hidden\"; }\r\n\r\n    fetch() {\r\n    }\r\n\r\n    getFieldValue(field: FormField): any {\r\n        return field.getValue();\r\n    }\r\n\r\n    getFieldMetaValue(field: FormField, metaKey: string): any {\r\n        return field.getMetaValue(metaKey);\r\n    }\r\n\r\n    setFieldValue(field: FormField, newValue: any): Set<string> {\r\n        return field.setValue(newValue);\r\n    }\r\n\r\n    setFieldMetaValue(field: FormField, metaKey: string, newValue: any): Set<string> {\r\n        return field.setMetaValue(metaKey, newValue);\r\n    }\r\n\r\n    getElementValue(element: Element): [any, FormFieldTypeElementStatus] {\r\n        if (!FormFieldType.isFormElement(element)) {\r\n            return [null, FormFieldTypeElementStatus.INVALID_ELEMENT];\r\n        }\r\n        if (element.type !== this.asElementType()) {\r\n            return [null, FormFieldTypeElementStatus.TYPE_MISMATCH];\r\n        }\r\n        return [element.value, FormFieldTypeElementStatus.VALUE_SUCCESSFULLY_RECEIVED];\r\n    }\r\n\r\n    setElementValue(element: Element, newValue: any): FormFieldTypeElementStatus {\r\n        if (!FormFieldType.isFormElement(element)) {\r\n            return FormFieldTypeElementStatus.INVALID_ELEMENT;\r\n        }\r\n        if (element.type !== this.asElementType()) {\r\n            return FormFieldTypeElementStatus.TYPE_MISMATCH;\r\n        }\r\n        element.value = newValue;\r\n        return FormFieldTypeElementStatus.VALUE_SET_SUCCESS;\r\n    }\r\n\r\n    getElementMetaValue(element: Element, metaKey: string): [any, FormFieldTypeElementStatus] {\r\n        if (!FormFieldType.isFormElement(element)) {\r\n            return [undefined, FormFieldTypeElementStatus.INVALID_ELEMENT];\r\n        }\r\n        if (element.type !== this.asElementType()) {\r\n            return [undefined, FormFieldTypeElementStatus.TYPE_MISMATCH];\r\n        }\r\n        if (metaKey === \"disabled\") {\r\n            return [element.disabled, FormFieldTypeElementStatus.META_VALUE_SUCCESSFULLY_RECEIVED];\r\n        }\r\n        return [undefined, FormFieldTypeElementStatus.META_KEY_NOT_EXISTS]\r\n    }\r\n\r\n    setElementMetaValue(element: Element, metaKey: string, newValue: any): FormFieldTypeElementStatus {\r\n        if (!FormFieldType.isFormElement(element)) {\r\n            return FormFieldTypeElementStatus.INVALID_ELEMENT;\r\n        }\r\n        if (element.type !== this.asElementType()) {\r\n            return FormFieldTypeElementStatus.TYPE_MISMATCH;\r\n        }\r\n        if (metaKey === \"disabled\") {\r\n            element.disabled = Boolean(newValue);\r\n            return FormFieldTypeElementStatus.META_VALUE_SET_SUCCESS;\r\n        }\r\n        return FormFieldTypeElementStatus.META_KEY_NOT_EXISTS;\r\n    }\r\n\r\n    getInitialValue(): any {\r\n        return null;\r\n    }\r\n\r\n    getInitialMeta(): Map<string, any> {\r\n        const meta = new Map();\r\n        meta.set(\"disabled\", false);\r\n        meta.set(\"dirty\", false);\r\n        return meta;\r\n    }\r\n\r\n    isSameType(otherType: FormFieldType): boolean {\r\n        return this.name === otherType.name;\r\n    }\r\n}\r\n\r\nexport class FormFieldTypeText extends FormFieldType {\r\n    private _area: boolean;\r\n\r\n    constructor() {\r\n        super(\"String\");\r\n        this._area = false;\r\n    }\r\n\r\n    area(value = true): this {\r\n        this._area = value;\r\n        return this;\r\n    }\r\n\r\n    asElementType(): string {\r\n        return this._area ? \"textarea\" : \"text\";\r\n    }\r\n}\r\n\r\nexport class FormFieldTypeNumber extends FormFieldType {\r\n    private _precision: number = 2;\r\n    constructor() {\r\n        super(\"Number\");\r\n    }\r\n\r\n    asElementType(): string {\r\n        return \"number\";\r\n    }\r\n}\r\n\r\nexport class FormFieldTypeDate extends FormFieldType {\r\n    constructor() {\r\n        super(\"Date\");\r\n    }\r\n\r\n    asElementType(): string {\r\n        return \"date\";\r\n    }\r\n\r\n    isEqual(a: any, b: any): boolean {\r\n        return a.toDateString() === b.toDateString();\r\n    }\r\n}\r\n\r\nexport class FormFieldTypeRadio extends FormFieldType {\r\n    constructor() {\r\n        super(\"Radio\");\r\n    }\r\n\r\n    asElementType(): string {\r\n        return \"radio\";\r\n    }\r\n\r\n    getInitialMeta(): Map<string, any> {\r\n        const meta = super.getInitialMeta();\r\n        meta.set(\"checked\", false);\r\n        return meta;\r\n    }\r\n\r\n    override getFieldValue(field: FormField): any {\r\n        return field.getMetaValue(\"checked\") ? field.getValue() : null;\r\n    }\r\n\r\n    override setFieldValue(field: FormField, newValue: any): any {\r\n        return field.setMetaValue(\"checked\", newValue != null && field.getValue() === newValue);\r\n    }\r\n\r\n    override getElementMetaValue(element: HTMLInputElement, metaKey: string): [any, FormFieldTypeElementStatus] {\r\n        const [value, status] = super.getElementMetaValue(element, metaKey);\r\n        if (status !== FormFieldTypeElementStatus.META_KEY_NOT_EXISTS) {\r\n            return [value, status];\r\n        }\r\n        if (metaKey === \"checked\") {\r\n            return [element.checked, FormFieldTypeElementStatus.META_VALUE_SUCCESSFULLY_RECEIVED];\r\n        }\r\n        return [undefined, FormFieldTypeElementStatus.META_KEY_NOT_EXISTS];\r\n    }\r\n\r\n    override setElementMetaValue(element: HTMLInputElement, metaKey: string, newValue: any): FormFieldTypeElementStatus {\r\n        const status = super.setElementMetaValue(element, metaKey, newValue);\r\n        if (status !== FormFieldTypeElementStatus.META_KEY_NOT_EXISTS) return status;\r\n        if (metaKey === \"checked\") {\r\n            element.checked = Boolean(newValue);\r\n            return FormFieldTypeElementStatus.META_VALUE_SET_SUCCESS;\r\n        }\r\n        return FormFieldTypeElementStatus.META_KEY_NOT_EXISTS;\r\n    }\r\n}\r\n\r\nexport class FormFieldTypeCheckbox extends FormFieldType {\r\n    constructor() {\r\n        super(\"Checkbox\");\r\n    }\r\n\r\n    asElementType(): string {\r\n        return \"checkbox\";\r\n    }\r\n\r\n    getInitialMeta(): Map<string, any> {\r\n        const meta = super.getInitialMeta();\r\n        meta.set(\"checked\", false);\r\n        return meta;\r\n    }\r\n\r\n    override getFieldValue(field: FormField): any {\r\n        const value = field.getValue();\r\n        if ([\"\", \"on\"].includes(value)) return field.getMetaValue(\"checked\");\r\n        return field.getMetaValue(\"checked\") ? value : null;\r\n    }\r\n\r\n    override setFieldValue(field: FormField, newValue: any): any {\r\n        if ([\"\", \"on\"].includes(field.getValue())) return field.setMetaValue(\"checked\", newValue);\r\n        return field.setMetaValue(\"checked\", newValue != null && field.getValue() === newValue);\r\n    }\r\n\r\n    override getElementMetaValue(element: HTMLInputElement, metaKey: string): [any, FormFieldTypeElementStatus] {\r\n        const [value, status] = super.getElementMetaValue(element, metaKey);\r\n        if (status !== FormFieldTypeElementStatus.META_KEY_NOT_EXISTS) {\r\n            return [value, status];\r\n        }\r\n        if (metaKey === \"checked\") {\r\n            return [element.checked, FormFieldTypeElementStatus.META_VALUE_SUCCESSFULLY_RECEIVED];\r\n        }\r\n        return [undefined, FormFieldTypeElementStatus.META_KEY_NOT_EXISTS];\r\n    }\r\n\r\n    override setElementMetaValue(element: HTMLInputElement, metaKey: string, newValue: any): FormFieldTypeElementStatus {\r\n        const status = super.setElementMetaValue(element, metaKey, newValue);\r\n        if (status !== FormFieldTypeElementStatus.META_KEY_NOT_EXISTS) return status;\r\n        if (metaKey === \"checked\") {\r\n            element.checked = Boolean(newValue);\r\n            return FormFieldTypeElementStatus.META_VALUE_SET_SUCCESS;\r\n        }\r\n        return FormFieldTypeElementStatus.META_KEY_NOT_EXISTS;\r\n    }\r\n}\r\n\r\nexport class FormFieldTypeSelect extends FormFieldType {\r\n    private _multiple: boolean;\r\n    private _of: FormFieldType;\r\n\r\n    constructor() {\r\n        super(\"select\");\r\n        this._multiple = false;\r\n        /**\r\n         * @type {FormFieldType}\r\n         */\r\n        this._of = FormFieldType.text();\r\n    }\r\n\r\n    asElementType(): string {\r\n        return this._multiple ? \"select-multiple\" : \"select-one\";\r\n    }\r\n\r\n    getInitialMeta(): Map<string, any> {\r\n        const meta = super.getInitialMeta();\r\n        meta.set(\"optionsInitialized\", false);\r\n        return meta;\r\n    }\r\n\r\n    multiple(value: boolean = true): this {\r\n        this._multiple = value;\r\n        return this;\r\n    }\r\n\r\n    of(type: FormFieldType): this {\r\n        this._of = type;\r\n        return this;\r\n    }\r\n\r\n    override getElementValue(element: HTMLSelectElement): [any, FormFieldTypeElementStatus] {\r\n        if (!FormFieldType.isFormElement(element)) {\r\n            return [undefined, FormFieldTypeElementStatus.INVALID_ELEMENT];\r\n        }\r\n        if (element.type !== this.asElementType()) {\r\n            return [undefined, FormFieldTypeElementStatus.TYPE_MISMATCH];\r\n        }\r\n        if (this._multiple) {\r\n            return [Array.from(element.selectedOptions, option => option.value), FormFieldTypeElementStatus.VALUE_SUCCESSFULLY_RECEIVED];\r\n        }\r\n        return [element.value, FormFieldTypeElementStatus.VALUE_SUCCESSFULLY_RECEIVED];\r\n    }\r\n\r\n    override setElementValue(element: HTMLSelectElement, newValue: any): FormFieldTypeElementStatus {\r\n        if (!FormFieldType.isFormElement(element)) {\r\n            return FormFieldTypeElementStatus.INVALID_ELEMENT;\r\n        }\r\n        if (element.type !== this.asElementType()) {\r\n            return FormFieldTypeElementStatus.TYPE_MISMATCH;\r\n        }\r\n        let options: (HTMLOptionElement | null)[];\r\n        if (this._multiple) {\r\n            options = newValue.map((value: any): HTMLOptionElement | null => {\r\n                return element.querySelector(`option[value=\"${value}\"]`);\r\n            });\r\n        } else {\r\n            options = [\r\n                element.querySelector(`option[value=\"${newValue}\"]`)\r\n            ]\r\n        }\r\n        if (options.some(option => option == null)) return FormFieldTypeElementStatus.FAILED_TO_SET_VALUE;\r\n        (options as HTMLOptionElement[]).forEach(option => {\r\n            option.selected = true;\r\n        });\r\n        return FormFieldTypeElementStatus.VALUE_SET_SUCCESS;\r\n    }\r\n}\r\n\r\nexport class FormFieldTypeObject extends FormFieldType {\r\n    constructor() {\r\n        super(\"Object\");\r\n    }\r\n\r\n    isEqual(a: any, b: any): boolean {\r\n        return deepEqual(a, b);\r\n    }\r\n}\r\n\r\nexport enum FormFieldChangeType {\r\n    Value,\r\n    MetaValue\r\n}\r\n\r\nexport interface FormFieldValueChange {\r\n    stateKey: string;\r\n    type: FormFieldChangeType.Value;\r\n    field: FormField;\r\n    oldValue: any;\r\n    newValue: any;\r\n    initiator: any;\r\n    processed: boolean;\r\n    last: boolean;\r\n    date: Date;\r\n}\r\n\r\nexport interface FormFieldMetaValueChange {\r\n    stateKey: string;\r\n    type: FormFieldChangeType.MetaValue;\r\n    field: FormField;\r\n    metaKey: string;\r\n    oldValue: any;\r\n    newValue: any;\r\n    initiator: any;\r\n    processed: boolean;\r\n    last: boolean;\r\n    date: Date;\r\n}\r\n\r\nexport type FormFieldChange = FormFieldValueChange | FormFieldMetaValueChange;\r\n\r\nexport class FormFieldChangesEvent extends Event {\r\n    constructor(public changes: FormFieldChange[]) {\r\n        super(\"changes\", { cancelable: true });\r\n    }\r\n}\r\n\r\ninterface FormFieldChangeFilter {\r\n    type?: FormFieldChangeType | null;\r\n    onlyCurrentState?: boolean;\r\n    last?: boolean | null;\r\n    processed?: boolean | null;\r\n}\r\n\r\ninterface FormFieldAnyChangeFilter extends FormFieldChangeFilter {\r\n    type?: FormFieldChangeType | null;\r\n    metaKey?: never;\r\n}\r\n\r\ninterface FormFieldValueChangeFilter extends FormFieldChangeFilter {\r\n    type: FormFieldChangeType.Value;\r\n    metaKey?: never;\r\n}\r\n\r\ninterface FormFieldMetaValueChangeFilter extends FormFieldChangeFilter {\r\n    type: FormFieldChangeType.MetaValue;\r\n    metaKey?: string | null;\r\n}\r\n\r\nexport class FormFieldChangeSet {\r\n    private _changes: FormFieldChange[];\r\n    private _maxSize: number;\r\n\r\n    constructor(maxSize = 128) {\r\n        this._changes = [];\r\n        this._maxSize = maxSize;\r\n    }\r\n\r\n    trimProcessedChanges() {\r\n        while (this._changes.length > this._maxSize) {\r\n            const index = this._changes.findIndex(c => c.processed);\r\n            if (index === -1) break;\r\n            this._changes.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    add(change: FormFieldChange): void {\r\n        let lastChange: FormFieldChange | undefined | null = null;\r\n        if (change.type === FormFieldChangeType.Value) {\r\n            lastChange = this.getFieldChange(change.field, { type: FormFieldChangeType.Value });\r\n        } else if (change.type === FormFieldChangeType.MetaValue) {\r\n            lastChange = this.getFieldChange(change.field, { type: FormFieldChangeType.MetaValue, metaKey: change.metaKey });\r\n        }\r\n        if (lastChange != null) {\r\n            lastChange.last = false;\r\n        }\r\n        this._changes.push(change);\r\n        this.trimProcessedChanges();\r\n    }\r\n\r\n    remove(change: FormFieldChange): void {\r\n        this._changes.splice(this._changes.indexOf(change), 1);\r\n    }\r\n\r\n    getFieldChange(field: FormField, filter: FormFieldValueChangeFilter): FormFieldValueChange | undefined;\r\n    getFieldChange(field: FormField, filter: FormFieldMetaValueChangeFilter): FormFieldMetaValueChange | undefined;\r\n    getFieldChange(field: FormField, filter: FormFieldAnyChangeFilter): FormFieldChange | undefined;\r\n    getFieldChange(field: FormField, { onlyCurrentState = true, last = true, processed = false, type = null, metaKey = null }: FormFieldAnyChangeFilter | FormFieldValueChangeFilter | FormFieldMetaValueChangeFilter = {}): FormFieldChange | undefined {\r\n        let changes = this.getFieldChanges(field, { onlyCurrentState, last, processed, type });\r\n        if (type === FormFieldChangeType.MetaValue && metaKey != null) {\r\n            changes = (changes as FormFieldMetaValueChange[]).filter(change => change.metaKey === metaKey);\r\n        }\r\n        return changes.at(-1);\r\n    }\r\n\r\n    getFieldChanges(field: FormField, filter?: FormFieldValueChangeFilter): FormFieldValueChange[];\r\n    getFieldChanges(field: FormField, filter?: FormFieldMetaValueChangeFilter): FormFieldMetaValueChange[];\r\n    getFieldChanges(field: FormField, filter?: FormFieldAnyChangeFilter): FormFieldChange[];\r\n    getFieldChanges(field: FormField, { onlyCurrentState = true, last = true, processed = false, type = null }: FormFieldAnyChangeFilter | FormFieldValueChangeFilter | FormFieldMetaValueChangeFilter = {}): FormFieldChange[] {\r\n        let changes = this._changes.filter(change => change.field === field);\r\n        if (type != null) { changes = changes.filter(change => change.type === type); }\r\n        if (last != null) { changes = changes.filter(change => change.last === last); }\r\n        if (processed != null) { changes = changes.filter(change => change.processed === processed); }\r\n        if (onlyCurrentState) { changes = changes.filter(change => change.stateKey === field.currentStateKey); }\r\n        return changes\r\n    }\r\n\r\n    hasChanges(field: FormField): boolean {\r\n        return this.getFieldChanges(field, { onlyCurrentState: true, last: true }).length !== 0;\r\n    }\r\n\r\n    markProcessed(changes: FormFieldChange[]): void {\r\n        changes.forEach(change => { change.processed = true; });\r\n        this.trimProcessedChanges();\r\n    }\r\n\r\n    static asChangedName(change: FormFieldChange): string | null {\r\n        if (change.type === FormFieldChangeType.Value) {\r\n            return change.field.name;\r\n        }\r\n        if (change.type === FormFieldChangeType.MetaValue) {\r\n            return getMetaDependencyKey(change.field.name, change.metaKey);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static asChangedNames(changes: FormFieldChange[]): Set<string> {\r\n        const changedNames = new Set<string>();\r\n        for (const change of changes) {\r\n            const changedName = this.asChangedName(change);\r\n            if (changedName == null) continue;\r\n            changedNames.add(changedName);\r\n        }\r\n        return changedNames;\r\n    }\r\n\r\n    processChanges(field: FormField, type: FormFieldChangeType | null = null, dryRun: boolean = false): Set<string> {\r\n        const lastChanges = this.getFieldChanges(field, { onlyCurrentState: true, type });\r\n        if (!dryRun) {\r\n            this.markProcessed(this.getFieldChanges(field, { onlyCurrentState: true, last: null, type }));\r\n            field.dispatchEvent(new FormFieldChangesEvent(lastChanges));\r\n        }\r\n        return FormFieldChangeSet.asChangedNames(lastChanges);\r\n    }\r\n}\r\n\r\nexport interface FormFieldContext {\r\n    stateKey?: string | null;\r\n    initiator?: any | null;\r\n    processChanges?: boolean;\r\n    disabledIsNull?: boolean;\r\n    raw?: boolean;\r\n}\r\n\r\nexport class FormField extends EventTarget {\r\n    private _name: string;\r\n    private _type: FormFieldType;\r\n    private _changeSet: FormFieldChangeSet;\r\n    private _initializedStateKeys: Set<string>;\r\n    private _initialValue: any;\r\n    private _valueMap: Map<string, any>;\r\n    private _initialMeta: Map<string, any>;\r\n    private _metaMap: Map<string, Map<string, any>>;\r\n    private _currentStateKey: string;\r\n\r\n    constructor(name: string, type: FormFieldType, { changeSet = null, effectManager = null }: { changeSet?: FormFieldChangeSet | null, effectManager?: EffectManager | null } = {}) {\r\n        super();\r\n        this._name = name;\r\n        this._type = type;\r\n        this._initializedStateKeys = new Set();\r\n\r\n        this._initialValue = this.type.getInitialValue();\r\n        this._valueMap = new Map();\r\n\r\n        this._initialMeta = this.type.getInitialMeta();\r\n        this._metaMap = new Map();\r\n\r\n        this._changeSet = changeSet ?? new FormFieldChangeSet(32);\r\n        this._currentStateKey = \"default\";\r\n        this.initializeState({ stateKey: \"default\" });\r\n        if (effectManager != null) {\r\n            this.initializeDependencies(effectManager);\r\n        }\r\n    }\r\n\r\n    get self(): this {\r\n        return this;\r\n    }\r\n\r\n    get currentStateKey() {\r\n        return this._currentStateKey;\r\n    }\r\n\r\n    get context(): FormFieldContext {\r\n        return {\r\n            disabledIsNull: true,\r\n            initiator: null,\r\n            stateKey: null,\r\n            raw: false,\r\n            processChanges: false\r\n        };\r\n    }\r\n\r\n    get changeSet(): FormFieldChangeSet {\r\n        return this._changeSet;\r\n    }\r\n\r\n    get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    get type(): FormFieldType {\r\n        return this._type;\r\n    }\r\n\r\n    clearInitialMeta(): void {\r\n        this._initialMeta = new Map();\r\n    }\r\n\r\n    reset({ stateKey = null, initiator = null, processChanges = false }: FormFieldContext = {}): Set<string> {\r\n        stateKey ??= this._currentStateKey;\r\n        console.log(\"[FormField.reset] Reset state `%s` for field `%s`\", stateKey, this.name);\r\n        this.setValue(this._initialValue, { raw: true, stateKey, initiator });\r\n        for (const [metaKey, value] of this._initialMeta.entries()) {\r\n            this.setMetaValue(metaKey, value, { raw: true, stateKey, initiator });\r\n        }\r\n        return this.processChanges(null, !processChanges);\r\n    }\r\n\r\n    initializeState({ stateKey, initiator = null }: FormFieldContext & { stateKey: string }): void {\r\n        if (!this._initializedStateKeys.has(stateKey)) {\r\n            console.log(\"[FormField.initializeState] Initializing state key `%s` for field `%s`\", stateKey, this.name);\r\n            this._initializedStateKeys.add(stateKey);\r\n            this._valueMap.set(stateKey, null);\r\n            this._metaMap.set(stateKey, new Map());\r\n            this.reset({ stateKey, initiator, processChanges: true });\r\n        }\r\n    }\r\n\r\n    switchState({ stateKey, initiator = null, processChanges = false }: FormFieldContext & { stateKey: string }): Set<string> {\r\n        console.log(\"[FormField.switchState] Switching state for field `%s` from `%s` to `%s`\", this.name, this._currentStateKey, stateKey);\r\n        this.initializeState({ stateKey, initiator });\r\n        const oldValue = this._valueMap.get(this._currentStateKey);\r\n        const newValue = this._valueMap.get(stateKey);\r\n        if (!this.type.isEqual(oldValue, newValue)) {\r\n            const change: FormFieldChange = {\r\n                stateKey,\r\n                type: FormFieldChangeType.Value,\r\n                field: this,\r\n                initiator,\r\n                oldValue,\r\n                newValue,\r\n                date: new Date(),\r\n                last: true,\r\n                processed: false\r\n            };\r\n            this.changeSet.add(change);\r\n        }\r\n\r\n        for (const [metaKey, newValue] of this._metaMap.get(stateKey)!.entries()) {\r\n            const oldValue = this._metaMap.get(this._currentStateKey)!.get(metaKey);\r\n            if (oldValue !== newValue) {\r\n                const change: FormFieldChange = {\r\n                    stateKey,\r\n                    type: FormFieldChangeType.MetaValue,\r\n                    field: this,\r\n                    initiator,\r\n                    metaKey,\r\n                    oldValue,\r\n                    newValue,\r\n                    date: new Date(),\r\n                    last: true,\r\n                    processed: false\r\n                };\r\n                this.changeSet.add(change);\r\n            }\r\n        }\r\n        this._currentStateKey = stateKey;\r\n        return this.processChanges(null, !processChanges);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {EffectManager} effectManager \r\n     */\r\n    initializeDependencies(effectManager: EffectManager) {\r\n        effectManager.addDependency(this.name, getMetaDependencyKey(this.name, \"disabled\"));\r\n        switch (this.type.asElementType()) {\r\n            case \"checkbox\":\r\n            case \"radio\":\r\n                effectManager.addDependency(this.name, getMetaDependencyKey(this.name, \"checked\"));\r\n                break;\r\n        }\r\n    }\r\n\r\n    getAdapter(outerContext: FormFieldContext) {\r\n        return new Proxy(this, {\r\n            get(target, propertyKey, receiver) {\r\n                switch (propertyKey) {\r\n                    case \"self\":\r\n                        return target;\r\n                    case \"context\":\r\n                        return outerContext;\r\n                    case \"getAdapter\":\r\n                        return (innerContext: FormFieldContext = {}) => target.getAdapter({ ...outerContext, ...innerContext });\r\n                    case \"getValue\":\r\n                        return (innerContext: FormFieldContext = {}) => target.getValue({ ...outerContext, ...innerContext });\r\n                    case \"getMetaValue\":\r\n                        return (metaKey: string, innerContext: FormFieldContext = {}) => target.getMetaValue(metaKey, { ...outerContext, ...innerContext });\r\n                    case \"setValue\":\r\n                        return (newValue: any, innerContext: FormFieldContext = {}) => target.setValue(newValue, { ...outerContext, ...innerContext });\r\n                    case \"setMetaValue\":\r\n                        return (metaKey: string, newValue: any, innerContext: FormFieldContext = {}) => target.setMetaValue(metaKey, newValue, { ...outerContext, ...innerContext });\r\n                    default:\r\n                        const value = Reflect.get(target, propertyKey, receiver);\r\n                        return typeof value === \"function\" ? value.bind(target) : value;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    getValue({ stateKey = null, raw = false, disabledIsNull = true }: FormFieldContext = {}): any {\r\n        if (raw) {\r\n            stateKey ??= this._currentStateKey\r\n            this.initializeState({ stateKey });\r\n            return this._valueMap.get(stateKey);\r\n        }\r\n        if (disabledIsNull && this.getMetaValue(\"disabled\", { stateKey })) {\r\n            return null;\r\n        }\r\n        return this.type.getFieldValue(this.getAdapter({ stateKey, raw: true }));\r\n    }\r\n\r\n    setInitialValue(newValue: any): void {\r\n        this._initialValue = newValue;\r\n    }\r\n\r\n    setValue(newValue: any, { stateKey = null, raw = false, initiator = null, processChanges = false }: FormFieldContext = {}): Set<string> {\r\n        if (raw) {\r\n            initiator ??= this;\r\n            stateKey ??= this._currentStateKey;\r\n            this.initializeState({ stateKey, initiator });\r\n            const oldValue = this.getValue({ stateKey, raw: true });\r\n            if (this.type.isEqual(oldValue, newValue)) return new Set();\r\n            this._valueMap.set(stateKey, newValue);\r\n            const change: FormFieldChange = {\r\n                stateKey,\r\n                type: FormFieldChangeType.Value,\r\n                field: this,\r\n                initiator,\r\n                oldValue,\r\n                newValue,\r\n                date: new Date(),\r\n                last: true,\r\n                processed: false\r\n            };\r\n            console.log(\"[FormField.setValue] Value changed:\", { oldValue, newValue, stateKey });\r\n            this.changeSet.add(change);\r\n            return this.processChanges(FormFieldChangeType.Value, !processChanges);\r\n        }\r\n        return this.type.setFieldValue(this.getAdapter({ stateKey, raw: true, processChanges, initiator }), newValue);\r\n    }\r\n\r\n    getMetaValue(metaKey: string, { stateKey = null, raw = false }: FormFieldContext = {}): any {\r\n        if (raw) {\r\n            stateKey ??= this._currentStateKey\r\n            this.initializeState({ stateKey });\r\n            const meta = this._metaMap.get(stateKey);\r\n            return meta!.get(metaKey);\r\n        }\r\n        return this.type.getFieldMetaValue(this.getAdapter({ raw: true, stateKey }), metaKey);\r\n    }\r\n\r\n    setInitialMetaValue(metaKey: string, newValue: any): void {\r\n        this._initialMeta.set(metaKey, newValue);\r\n    }\r\n\r\n    setMetaValue(metaKey: string, newValue: any, { stateKey = null, initiator = null, processChanges = false, raw = false }: FormFieldContext = {}): Set<string> {\r\n        if (raw) {\r\n            initiator ??= this;\r\n            stateKey ??= this._currentStateKey;\r\n            this.initializeState({ stateKey, initiator });\r\n            const oldValue = this.getMetaValue(metaKey, { stateKey });\r\n            if (oldValue === newValue) return new Set();\r\n            this._metaMap.get(stateKey)!.set(metaKey, newValue);\r\n            const change: FormFieldChange = {\r\n                stateKey,\r\n                type: FormFieldChangeType.MetaValue,\r\n                field: this,\r\n                initiator,\r\n                metaKey,\r\n                oldValue,\r\n                newValue,\r\n                date: new Date(),\r\n                last: true,\r\n                processed: false\r\n            };\r\n            this.changeSet.add(change);\r\n            console.log(\"[FormField.setMetaValue] Meta\", getMetaDependencyKey(this.name, metaKey), \"value changed:\", { oldValue, newValue, stateKey });\r\n            return this.processChanges(FormFieldChangeType.MetaValue, !processChanges);\r\n        }\r\n        return this.type.setFieldMetaValue(this.getAdapter({ stateKey, raw: true, initiator, processChanges }), metaKey, newValue);\r\n    }\r\n\r\n    processChanges(type: FormFieldChangeType | null = null, dryRun: boolean = false): Set<string> {\r\n        return this.changeSet.processChanges(this, type, dryRun);\r\n    }\r\n}\r\n\r\nexport class FormFieldArray {\r\n    constructor(public fieldArray: FormField[]) { }\r\n\r\n    getAdapter(outerContext: FormFieldContext) {\r\n        return new Proxy(this, {\r\n            get(target, propertyKey, receiver) {\r\n                switch (propertyKey) {\r\n                    case \"self\":\r\n                        return target;\r\n                    case \"context\":\r\n                        return outerContext;\r\n                    case \"getAdapter\":\r\n                        return (innerContext: FormFieldContext = {}) => target.getAdapter({ ...outerContext, ...innerContext });\r\n                    case \"getValue\":\r\n                        return (innerContext: FormFieldContext = {}) => target.getValue({ ...outerContext, ...innerContext });\r\n                    case \"getMetaValue\":\r\n                        return (metaKey: string, innerContext: FormFieldContext = {}) => target.getMetaValue(metaKey, { ...outerContext, ...innerContext });\r\n                    case \"setValue\":\r\n                        return (newValue: any, innerContext: FormFieldContext = {}) => target.setValue(newValue, { ...outerContext, ...innerContext });\r\n                    case \"setMetaValue\":\r\n                        return (metaKey: string, newValue: any, innerContext: FormFieldContext = {}) => target.setMetaValue(metaKey, newValue, { ...outerContext, ...innerContext });\r\n                    default:\r\n                        const value = Reflect.get(target, propertyKey, receiver);\r\n                        return typeof value === \"function\" ? value.bind(target) : value;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    getValue({ stateKey = null, disabledIsNull = true, raw = false }: FormFieldContext = {}): any {\r\n        return this.fieldArray.map(field => field.getValue({ stateKey, disabledIsNull, raw })).find(value => value != null);\r\n    }\r\n\r\n    getMetaValue(metaKey: string, { stateKey = null, raw = false }: FormFieldContext = {}): any {\r\n        return this.fieldArray.map(field => field.getMetaValue(metaKey, { stateKey, raw })).find(value => value != null);\r\n    }\r\n\r\n    setValue(value: any, { stateKey = null, initiator = null, processChanges = false, raw = false }: FormFieldContext = {}): Set<string> {\r\n        return this.fieldArray.map(field => field.setValue(value, { stateKey, initiator, processChanges, raw })).find(changedNames => changedNames.size !== 0) ?? new Set();\r\n    }\r\n\r\n    setMetaValue(metaKey: string, value: any, { stateKey = null, initiator = null, processChanges = false, raw = false }: FormFieldContext = {}): Set<string> {\r\n        return this.fieldArray.map(field => field.setMetaValue(metaKey, value, { stateKey, initiator, processChanges, raw })).find(changedNames => changedNames.size !== 0) ?? new Set();\r\n    }\r\n\r\n    processChanges(type: FormFieldChangeType | null = null, dryRun: boolean = false): Set<string> {\r\n        return this.fieldArray.map(field => field.processChanges(type, dryRun)).find(changedNames => changedNames.size !== 0) ?? new Set();\r\n    }\r\n}\r\n\r\nexport abstract class FormFieldLinker {\r\n    public field: FormField;\r\n    public type: FormFieldType;\r\n\r\n    constructor(field: FormField) {\r\n        this.field = field;\r\n        this.type = field.type;\r\n    }\r\n\r\n    abstract link(): void;\r\n    abstract unlink(): void;\r\n}\r\n\r\nexport class FormFieldElementLinker extends FormFieldLinker {\r\n    public element: FormElement;\r\n    private _mutationObserver: MutationObserver;\r\n    private _handleHideContainer: ((event: Event) => void) | null;\r\n    /**\r\n     * \r\n     * @param {FormField} field \r\n     * @param {Element} element \r\n     */\r\n    constructor(field: FormField, element: FormElement) {\r\n        super(field);\r\n        this.element = element;\r\n        if (this.type.asElementType() !== this.element.type) {\r\n            throw new Error(\"For link type is equal\")\r\n        }\r\n        this._fieldChangesEventListener = this._fieldChangesEventListener.bind(this);\r\n        this._elementValueInputEventListener = this._elementValueInputEventListener.bind(this);\r\n        this._elementValueChangeEventListener = this._elementValueChangeEventListener.bind(this);\r\n        this._handleHideContainer = null;\r\n        this._mutationObserver = new MutationObserver((mutations) => {\r\n            for (const mutation of mutations) {\r\n                if (mutation.type === \"attributes\") {\r\n                    switch (mutation.attributeName) {\r\n                        case \"disabled\":\r\n                            this._syncFieldMetaValue(\"disabled\");\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    override link(): void {\r\n        this.field.setInitialValue(this._getElementValue());\r\n        this.field.setInitialMetaValue(\"disabled\", this._getElementMetaValue(\"disabled\"));\r\n        this.field.setInitialMetaValue(\"visible\", true);\r\n        this.field.setInitialMetaValue(\"container\", this.element.parentElement);\r\n        if ([\"radio\", \"checkbox\"].includes(this.type.asElementType())) {\r\n            this.field.setInitialMetaValue(\"checked\", this._getElementMetaValue(\"checked\"));\r\n        }\r\n        this.field.reset({ processChanges: true, initiator: this });\r\n\r\n        this.field.addEventListener(\"changes\", this._fieldChangesEventListener);\r\n        if ([\"text\", \"number\", \"textarea\"].includes(this.type.asElementType())) {\r\n            this.element.addEventListener(\"input\", this._elementValueInputEventListener);\r\n        } else {\r\n            this.element.addEventListener(\"change\", this._elementValueChangeEventListener);\r\n        }\r\n\r\n        this._mutationObserver.observe(this.element, {\r\n            attributes: true,\r\n            attributeFilter: [\"disabled\"]\r\n        });\r\n    }\r\n\r\n    override unlink(): void {\r\n        this.field.removeEventListener(\"changes\", this._fieldChangesEventListener);\r\n        if ([\"text\", \"number\", \"textarea\"].includes(this.type.asElementType())) {\r\n            this.element.removeEventListener(\"input\", this._elementValueInputEventListener);\r\n        } else {\r\n            this.element.removeEventListener(\"change\", this._elementValueChangeEventListener);\r\n        }\r\n        this._mutationObserver.disconnect();\r\n    }\r\n\r\n    _elementValueInputEventListener(event: Event): void {\r\n        console.log(\"[FormFieldElementLinker._elementValueInputEventListener] Event\")\r\n        this.field.setMetaValue(\"dirty\", true, { initiator: this, processChanges: true });\r\n        this._syncFieldValue();\r\n    }\r\n\r\n    _elementValueChangeEventListener(event: Event): void {\r\n        this.field.setMetaValue(\"dirty\", true, { initiator: this, processChanges: true });\r\n        if ([\"radio\", \"checkbox\"].includes(this.type.asElementType())) {\r\n            this._syncFieldMetaValue(\"checked\");\r\n        } else {\r\n            this._syncFieldValue();\r\n        }\r\n    }\r\n\r\n    _fieldChangesEventListener(event: Event) {\r\n        const changes = (event as FormFieldChangesEvent).changes.filter(change => change.initiator !== this);\r\n        for (const change of changes) {\r\n            if (change.type === FormFieldChangeType.Value) {\r\n                this._syncElementValue();\r\n            } else if (change.type === FormFieldChangeType.MetaValue) {\r\n                this._syncElementMetaValue(change.metaKey);\r\n            }\r\n        }\r\n    }\r\n\r\n    _syncElementValue(): void {\r\n        console.log(\"[FormFieldElementLinker._syncElementValue] Syncing element value\");\r\n        const value = this.field.getValue({ raw: true });\r\n        const status = this.type.setElementValue(this.element, value);\r\n        if (status !== FormFieldTypeElementStatus.VALUE_SET_SUCCESS) {\r\n            console.log(\"[FormFieldElementLinker._syncElementMetaValue] Failed to set element value, status `%s`\", status);\r\n            return;\r\n        }\r\n    }\r\n\r\n    _getElementValue(): any {\r\n        const [value, status] = this.type.getElementValue(this.element);\r\n        if (status !== FormFieldTypeElementStatus.VALUE_SUCCESSFULLY_RECEIVED) {\r\n            console.warn(\"[FormFieldElementLinker._getElementValue] Failed to get value from element, status `%s`\", status);\r\n        }\r\n        return value;\r\n    }\r\n\r\n    _syncFieldValue(): void {\r\n        console.log(\"[FormFieldElementLinker._syncFieldValue] Syncing field value\");\r\n        this.field.setValue(this._getElementValue(), { initiator: this, processChanges: true, raw: true });\r\n    }\r\n\r\n    _syncElementMetaValue(metaKey: string): void {\r\n        console.log(\"[FormFieldElementLinker._syncElementMetaValue] Syncing element meta value\");\r\n        const value = this.field.getMetaValue(metaKey, { raw: true });\r\n        const status = this.type.setElementMetaValue(this.element, metaKey, value);\r\n        if (status === FormFieldTypeElementStatus.META_VALUE_SET_SUCCESS) {\r\n            return;\r\n        }\r\n        if (status === FormFieldTypeElementStatus.META_KEY_NOT_EXISTS) {\r\n            switch (metaKey) {\r\n                case \"visible\":\r\n                    const container = this.field.getMetaValue(\"container\") as HTMLElement;\r\n                    if (this._handleHideContainer != null) {\r\n                        container.removeEventListener(\"transitionend\", this._handleHideContainer);\r\n                        this._handleHideContainer = null;\r\n                    }\r\n                    if (value) {\r\n                        if (container.style.display === \"none\") {\r\n                            container.style.display = \"\";\r\n                            requestAnimationFrame(() => {\r\n                                container.dataset.visible = \"true\";\r\n                            });\r\n                        } else {\r\n                            container.dataset.visible = \"true\";\r\n                        }\r\n                    } else {\r\n                        if (container.style.display !== \"none\") {\r\n                            this._handleHideContainer = (event: Event) => {\r\n                                container.style.display = \"none\";\r\n                            };\r\n                            container.addEventListener(\"transitionend\", this._handleHideContainer, { once: true });\r\n                        }\r\n                        container.dataset.visible = \"false\";\r\n                    }\r\n                    break;\r\n                case \"autofill\":\r\n                    this.element.classList.toggle(\"autofill\", !!value);\r\n                    break;\r\n                case \"optionsInitialized\":\r\n                    // console.log(\"options initialized\", !!value);\r\n                    if (value) {\r\n                        this._syncElementValue();\r\n                    }\r\n                    break;\r\n            }\r\n            return;\r\n        }\r\n\r\n        console.log(\"[FormFieldElementLinker._syncElementMetaValue] Failed to set element meta value, status `%s`\", status);\r\n    }\r\n\r\n    _getElementMetaValue(metaKey: string): any {\r\n        const [value, status] = this.type.getElementMetaValue(this.element, metaKey);\r\n        if (status !== FormFieldTypeElementStatus.META_VALUE_SUCCESSFULLY_RECEIVED) {\r\n            console.warn(\"[FormFieldElementLinker._getElementMetaValue] Failed to get value from element, status `%s`\", status);\r\n        }\r\n        return value;\r\n    }\r\n\r\n    _syncFieldMetaValue(metaKey: string): void {\r\n        console.log(\"[FormFieldElementLinker._syncFieldMeta] Syncing field meta value\");\r\n        this.field.setMetaValue(metaKey, this._getElementMetaValue(metaKey), { initiator: this, processChanges: true });\r\n    }\r\n}\r\n\r\nexport class FormFields extends EventTarget {\r\n    public list: FormField[];\r\n\r\n    constructor() {\r\n        super();\r\n        this.list = [];\r\n        this._fieldChangesEventListener = this._fieldChangesEventListener.bind(this);\r\n    }\r\n\r\n    _fieldChangesEventListener(event: Event) {\r\n        this.dispatchEvent(new FormFieldChangesEvent((event as FormFieldChangesEvent).changes));\r\n    }\r\n\r\n    add(field: FormField) {\r\n        field = field.self;\r\n        if (this.list.includes(field)) return false;\r\n        field.addEventListener(\"changes\", this._fieldChangesEventListener);\r\n        this.list.push(field);\r\n        return true;\r\n    }\r\n\r\n    remove(field: FormField) {\r\n        field = field.self;\r\n        if (!this.list.includes(field)) return false;\r\n        field.removeEventListener(\"changes\", this._fieldChangesEventListener);\r\n        this.list.splice(this.list.indexOf(field), 1);\r\n        return true;\r\n    }\r\n\r\n    get(fieldName: string): FormField | FormFieldArray {\r\n        const fields = this.list.filter(field => field.name === fieldName)\r\n        return fields.length === 1 ? fields[0] : new FormFieldArray(fields);\r\n    }\r\n\r\n    [Symbol.iterator](): Iterator<string> {\r\n        return new Set(this.list.map(field => field.name)).values();\r\n    }\r\n}\r\n\r\nexport interface Option {\r\n    value: string;\r\n    textContent: string;\r\n}\r\n\r\nexport abstract class FormChangesManager {\r\n    abstract manage(form: Form, changes: FormFieldChange[]): void;\r\n}\r\n\r\nexport class FormChangesForRadioManager extends FormChangesManager {\r\n    override manage(form: Form, changes: FormFieldChange[]): void {\r\n        changes.filter(change =>\r\n            change.initiator !== form &&\r\n            change.field.type.asElementType() === \"radio\" &&\r\n            change.type === FormFieldChangeType.MetaValue &&\r\n            change.metaKey === \"checked\" &&\r\n            change.newValue\r\n        ).forEach(change => {\r\n            form.fields.list.filter(field =>\r\n                field.name === change.field.name &&\r\n                field.type.asElementType() === \"radio\" &&\r\n                field != change.field &&\r\n                field.getMetaValue(\"checked\")\r\n            ).forEach(field => {\r\n                field.setMetaValue(\"checked\", false, { initiator: form, processChanges: true });\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\nexport class FormChangesForTriggerEffectsManager extends FormChangesManager {\r\n    override manage(form: Form, changes: FormFieldChange[]): void {\r\n        changes = changes.filter(change => change.initiator !== form);\r\n        if (changes.length === 0) return;\r\n        form.effectManager.triggerEffects({ changedNames: FormFieldChangeSet.asChangedNames(changes) });\r\n    }\r\n}\r\n\r\nexport class Form extends EventTarget {\r\n    public form: HTMLFormElement;\r\n    public effectManager: EffectManager;\r\n    public fields: FormFields;\r\n    public fieldLinkers: FormFieldLinker[];\r\n    public changeSet: FormFieldChangeSet;\r\n    private _changesManagers: FormChangesManager[];\r\n\r\n    constructor({ form }: { form: HTMLFormElement }) {\r\n        super();\r\n        this.form = form;\r\n        this.changeSet = new FormFieldChangeSet();\r\n        this.effectManager = new EffectManager();\r\n        this.fields = new FormFields();\r\n        this.fieldLinkers = [];\r\n        this._changesManagers = [];\r\n        this._handleChanges = this._handleChanges.bind(this);\r\n    }\r\n\r\n    async setup() {\r\n        if (this.form != null) {\r\n            this.form.classList.add(\"ss-form\");\r\n            this.form.addEventListener(\"submit\", (event) => {\r\n                event.preventDefault();\r\n                this.submit().then(() => this.reset());\r\n            });\r\n\r\n            this.form.addEventListener(\"reset\", (event) => {\r\n                event.preventDefault();\r\n                this.reset();\r\n            });\r\n\r\n            this.fields.addEventListener(\"changes\", this._handleChanges);\r\n            this.registerChangesManager(new FormChangesForRadioManager());\r\n            this.registerChangesManager(new FormChangesForTriggerEffectsManager());\r\n            this.registerElements();\r\n        }\r\n    }\r\n\r\n    _handleChanges(event: Event) {\r\n        const changes = (event as FormFieldChangesEvent).changes;\r\n        for (const changesManager of this._changesManagers) {\r\n            changesManager.manage(this, changes);\r\n        }\r\n    }\r\n\r\n    switchState(stateKey: string) {\r\n        for (const field of this.fields.list) {\r\n            field.switchState({ stateKey, initiator: this, processChanges: true });\r\n        }\r\n        this.effectManager.triggerEffects();\r\n    }\r\n\r\n    registerChangesManager(changesManager: FormChangesManager) {\r\n        this._changesManagers.push(changesManager);\r\n    }\r\n\r\n    getFormData(): Record<string, any> {\r\n        const formData: Record<string, any> = {};\r\n        for (const fieldName of this.fields) {\r\n            formData[fieldName] = this.fields.get(fieldName).getValue();\r\n        }\r\n        return formData;\r\n    }\r\n\r\n    updateFormData(formData: Record<string, any>) {\r\n        for (const fieldName of this.fields) {\r\n            if (!(fieldName in formData)) continue;\r\n            this.fields.get(fieldName).setValue(formData[fieldName], { initiator: this });\r\n        }\r\n        this.effectManager.triggerEffects();\r\n    }\r\n\r\n    registerElements(): void {\r\n        for (const element of this.form.elements) {\r\n            if (!FormFieldType.isFormElement(element)) {\r\n                continue;\r\n            }\r\n            if (element.name === \"\") continue;\r\n            const field = new FormField(element.name, FormFieldType.fromFormElement(element), { changeSet: this.changeSet, effectManager: this.effectManager });\r\n            const fieldElementLinker = new FormFieldElementLinker(field, element);\r\n            fieldElementLinker.link();\r\n            this.fieldLinkers.push(fieldElementLinker);\r\n            this.fields.add(field);\r\n        }\r\n    }\r\n\r\n    getElement(name: string): Element | RadioNodeList | null {\r\n        return this.form.elements.namedItem(name);\r\n    }\r\n\r\n    async submit(): Promise<void> {\r\n\r\n    }\r\n\r\n    reset(): void {\r\n        for (const field of this.fields.list) {\r\n            field.reset({ initiator: this });\r\n        }\r\n        this.effectManager.triggerEffects();\r\n    }\r\n\r\n    addDisableWhenEffect(fieldName: string, disableWhen: () => Promise<boolean> | boolean, dependsOn: string[]): void {\r\n        this.effectManager.addEffect(getMetaDependencyKey(fieldName, \"disabled\"), {\r\n            type: \"disable-when\",\r\n            callback: async () => {\r\n                const disabled = await disableWhen();\r\n                // console.log(`[Effect.DisableWhen] Field ${fieldName} disabled: `, disabled);\r\n                const field = this.fields.get(fieldName).getAdapter({ initiator: this });\r\n                return field.setMetaValue(\"disabled\", disabled, { processChanges: true });\r\n            },\r\n            dependsOn,\r\n        });\r\n    }\r\n\r\n    addVisibleWhenEffect(fieldName: string, visibleWhen: () => Promise<boolean> | boolean, dependsOn: string[]): void {\r\n        this.addDisableWhenEffect(fieldName, async () => !await visibleWhen(), dependsOn);\r\n        this.effectManager.addEffect(getMetaDependencyKey(fieldName, \"visible\"), {\r\n            type: \"visible-when\",\r\n            callback: async () => {\r\n                const visible = await visibleWhen();\r\n                // console.log(`[Effect.VisibleWhen] Field ${fieldName} visible: `, visible);\r\n                const field = this.fields.get(fieldName).getAdapter({ initiator: this });\r\n                return field.setMetaValue(\"visible\", visible, { processChanges: true });\r\n            },\r\n            dependsOn: [getMetaDependencyKey(fieldName, \"disabled\")]\r\n        });\r\n    }\r\n\r\n    addComputedFieldEffect(fieldName: string, fieldType: FormFieldType, compute: () => Promise<any> | any, dependsOn: string[]): void {\r\n        this.fields.add(new FormField(fieldName, fieldType, { changeSet: this.changeSet, effectManager: this.effectManager }))\r\n        this.effectManager.addEffect(fieldName, {\r\n            type: \"computed-field\",\r\n            callback: async () => {\r\n                const value = await compute();\r\n                // console.log(`[Effect.ComputedField] Field ${fieldName} value: `, value);\r\n                const field = this.fields.get(fieldName);\r\n                return field.setValue(value, { initiator: this, processChanges: true });\r\n            },\r\n            dependsOn\r\n        });\r\n    }\r\n\r\n    addFieldAutofillEffect(fieldName: string, autofillWith: () => Promise<any> | any, dependsOn: string[]): void {\r\n        this.effectManager.addDependency(fieldName, getMetaDependencyKey(fieldName, \"autofill\"));\r\n        this.effectManager.addEffect(getMetaDependencyKey(fieldName, \"autofill\"), {\r\n            type: \"field-autofill\",\r\n            callback: async () => {\r\n                const field = this.fields.get(fieldName).getAdapter({ initiator: this });\r\n                const dirty = field.getMetaValue(\"dirty\");\r\n                field.setMetaValue(\"autofill\", !dirty);\r\n                if (dirty) {\r\n                    return field.processChanges();\r\n                }\r\n                const value = await autofillWith();\r\n                // console.log(`[Effect.FieldAutofill] Field ${fieldName} value: `, value);\r\n                field.setMetaValue(\"autofill\", field.setValue(value).size !== 0);\r\n                return field.processChanges();\r\n            },\r\n            dependsOn: [getMetaDependencyKey(fieldName, \"dirty\"), ...dependsOn]\r\n        });\r\n    }\r\n\r\n    addSelectOptionsInitializerEffect(fieldName: string, getDefaultOption: () => Promise<Option> | Option, getOptions: () => Promise<Option[]> | Option[], dependsOn: string[]): void {\r\n        this.effectManager.addEffect(fieldName, {\r\n            type: \"select-options-initializer\",\r\n            callback: async () => {\r\n                const defaultOption = await getDefaultOption();\r\n                const options = await getOptions();\r\n                const selectElement = this.getElement(fieldName) as HTMLSelectElement;\r\n                const field = this.fields.get(fieldName).getAdapter({ initiator: this });\r\n                const selectedValue = field.getValue({ disabledIsNull: false });\r\n                field.setValue(defaultOption.value);\r\n                selectElement.innerHTML = \"\";\r\n                for (const option of [defaultOption, ...options]) {\r\n                    const optionElement = document.createElement(\"option\");\r\n                    optionElement.value = option.value;\r\n                    optionElement.textContent = option.textContent;\r\n                    selectElement.options.add(optionElement);\r\n                }\r\n                field.setValue(selectedValue);\r\n                field.setMetaValue(\"disabled\", options.length === 0);\r\n                field.setMetaValue(\"optionsInitialized\", options.length !== 0);\r\n                return field.processChanges();\r\n            },\r\n            dependsOn\r\n        });\r\n    }\r\n}","\r\n\r\nexport interface ColumnDefinition {\r\n    key: string;\r\n    title: string;\r\n}\r\n\r\n\r\nexport class Column {\r\n\r\n}\r\n\r\n\r\n\r\n\r\nexport class Table {\r\n    public container: HTMLElement;\r\n    public columnDefinitions: ColumnDefinition[];\r\n    constructor({ container, columnDefinitions }: { container: HTMLElement, columnDefinitions: ColumnDefinition[] }) {\r\n        this.container = container;\r\n        this.columnDefinitions = columnDefinitions;\r\n        this.render();\r\n    }\r\n\r\n\r\n\r\n    async render() {\r\n        const tableElement = document.createElement(\"div\");\r\n        tableElement.innerHTML = `\r\n            <div class=\"ss-table\">\r\n                <div class=\"ss-table-head\">\r\n                    <div class=\"ss-table-row\">\r\n                        <div class=\"ss-table-header-columns-pinned-left\">\r\n                        </div>\r\n                        <div class=\"ss-table-header-columns\">\r\n                            \r\n                        </div>\r\n                        <div class=\"ss-table-header-columns-pinned-right\">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"ss-table-body\">\r\n                    <div class=\"ss-table-body-row-columns-pinned-left\">\r\n                        \r\n                    </div>\r\n                    <div class=\"ss-table-body-rows\">\r\n                        <div class=\"ss-table-body-row\">\r\n                            <div class=\"ss-table-body-cell\">\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"ss-table-body-row-columns-pinned-right\">\r\n                    </div>\r\n                </div>\r\n                <div class=\"ss-table-footer\">\r\n                    <div class=\"ss-table-footer-row-columns-pinned-left\">\r\n                    </div>\r\n                    <div class=\"ss-table-footer-rows\">\r\n                        <div class=\"ss-table-footer-row\">\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"ss-table-footer-row-columns-pinned-left\">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n        const headersElement = tableElement.querySelector(\".ss-table-header-columns\")!;\r\n        for (const columnDefinition of this.columnDefinitions) {\r\n            const headerElement = document.createElement(\"div\");\r\n            headerElement.classList.add(\"ss-table-cell\");\r\n            headerElement.classList.add(\"ss-table-header-column\");\r\n            headerElement.textContent = columnDefinition.title;\r\n            headersElement.append(headerElement);\r\n        }\r\n        this.container.innerHTML = '';\r\n        this.container.append(tableElement);\r\n    }\r\n}"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","DependencyGraph","constructor","this","_keys","Set","_dependentMap","Map","_dependencyMap","_addedDependencies","_topologicalOrder","getDependencies","buildDependenciesMap","dependencies","dependent","dependency","add","has","set","inDegree","size","queue","degree","push","length","shift","Error","addDependency","keys","topologicalOrder","dependentMap","dependencyMap","EffectManager","_keyEffect","super","effect","dependsOn","concat","addEffect","triggerEffects","changedNames","arguments","undefined","name","intersection","changedNamesByEffect","callback","forEach","changedName","deepEqual","a","b","aKeys","bKeys","getMetaDependencyKey","fieldName","metaKey","FormFieldValidator","validate","field","FormFieldValidatorRequired","FormFieldTypeElementStatus","FormFieldType","object","FormFieldTypeObject","text","FormFieldTypeText","number","FormFieldTypeNumber","date","FormFieldTypeDate","select","multiple","FormFieldTypeSelect","checkbox","FormFieldTypeCheckbox","radio","FormFieldTypeRadio","isFormElement","element","HTMLInputElement","HTMLSelectElement","HTMLTextAreaElement","fromFormElement","type","area","isEqual","isEmpty","asElementType","fetch","getFieldValue","getValue","getFieldMetaValue","getMetaValue","setFieldValue","newValue","setValue","setFieldMetaValue","setMetaValue","getElementValue","TYPE_MISMATCH","VALUE_SUCCESSFULLY_RECEIVED","INVALID_ELEMENT","setElementValue","VALUE_SET_SUCCESS","getElementMetaValue","disabled","META_VALUE_SUCCESSFULLY_RECEIVED","META_KEY_NOT_EXISTS","setElementMetaValue","Boolean","META_VALUE_SET_SUCCESS","getInitialValue","getInitialMeta","meta","isSameType","otherType","_area","_precision","toDateString","status","checked","includes","_multiple","_of","of","Array","from","selectedOptions","option","options","map","querySelector","some","FAILED_TO_SET_VALUE","selected","FormFieldChangeType","FormFieldChangesEvent","Event","changes","cancelable","FormFieldChangeSet","maxSize","_changes","_maxSize","trimProcessedChanges","index","findIndex","c","processed","splice","change","lastChange","Value","getFieldChange","MetaValue","last","remove","indexOf","onlyCurrentState","getFieldChanges","filter","at","stateKey","currentStateKey","hasChanges","markProcessed","asChangedName","asChangedNames","processChanges","dryRun","lastChanges","dispatchEvent","FormField","EventTarget","changeSet","effectManager","_name","_type","_initializedStateKeys","_initialValue","_valueMap","_initialMeta","_metaMap","_changeSet","_currentStateKey","initializeState","initializeDependencies","self","context","disabledIsNull","initiator","raw","clearInitialMeta","reset","console","log","entries","_ref","switchState","_ref2","oldValue","Date","getAdapter","outerContext","Proxy","target","propertyKey","receiver","innerContext","Reflect","bind","setInitialValue","setInitialMetaValue","FormFieldArray","fieldArray","find","FormFieldLinker","FormFieldElementLinker","_fieldChangesEventListener","_elementValueInputEventListener","_elementValueChangeEventListener","_handleHideContainer","_mutationObserver","MutationObserver","mutations","mutation","attributeName","_syncFieldMetaValue","link","_getElementValue","_getElementMetaValue","parentElement","addEventListener","observe","attributes","attributeFilter","unlink","removeEventListener","disconnect","event","_syncFieldValue","_syncElementValue","_syncElementMetaValue","warn","container","style","display","requestAnimationFrame","dataset","visible","once","classList","toggle","FormFields","list","fields","iterator","values","FormChangesManager","FormChangesForRadioManager","manage","form","FormChangesForTriggerEffectsManager","Form","_ref3","fieldLinkers","_changesManagers","_handleChanges","setup","preventDefault","submit","then","registerChangesManager","registerElements","changesManager","getFormData","formData","updateFormData","elements","fieldElementLinker","getElement","namedItem","addDisableWhenEffect","disableWhen","async","addVisibleWhenEffect","visibleWhen","addComputedFieldEffect","fieldType","compute","addFieldAutofillEffect","autofillWith","dirty","addSelectOptionsInitializerEffect","getDefaultOption","getOptions","defaultOption","selectElement","selectedValue","innerHTML","optionElement","document","createElement","textContent","Column","Table","columnDefinitions","render","tableElement","headersElement","columnDefinition","headerElement","title","append"],"sourceRoot":""}