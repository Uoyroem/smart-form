<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example 1</title>
    <link rel="stylesheet" href="/dist/smart-system.min.css">
</head>

<body>
    <div role=""></div>
    <form id="test-form">
        <div style="width: 100px;">
            <input style="display: block; width: 100%;" type="number" name="amount" id="amount-input">
            <input style="display: block; width: 100%;" type="number" name="percent" id="percent-input">
            <input style="display: block; width: 100%;" type="number" name="total" id="total-input">
            <div>
                <input style="display: block; width: 100%;" type="number" name="total-pristine" id="total-pristine-input">
            </div>
        </div>
    </form>
    <div id="table-container">

    </div>
    <script src="/dist/smart-system.bundle.min.js"></script>
    <script>

        const table = new SmartSystem.Table({container: document.getElementById("table-container"), columnDefinitions: [
            {
                key: "date",
                title: "Дата"
            },
            {
                key: "account",
                title: "Расчётный счёт"
            },
            {
                key: "amount",
                title: "Сумма"
            },
        ]});

        class TestForm extends SmartSystem.Form {
            constructor() {
                super({ form: document.forms["test-form"] });
            }

            async setup() {
                super.setup();
                this.addFieldAutofillEffect("total", async () => {
                    const amountField = this.fields.get("amount").getAdapter({ initiator: this });
                    const percentField = this.fields.get("percent").getAdapter({ initiator: this });
                    if (amountField.getValue() && percentField.getValue()) {
                        return amountField.getValue() * percentField.getValue() / 100;
                    }
                    return 0;
                }, ["amount", "percent"]);
                this.addVisibleWhenEffect("total-pristine", async () => {
                    const totalField = this.fields.get("total").getAdapter({ initiator: this });

                    return totalField.getValue() && totalField.getValue() > 100;
                }, ["total"]);
                this.effectManager.buildDependenciesMap();
                this.effectManager.triggerEffects();
            }
        }
        const testForm = new TestForm();
        testForm.setup();
    </script>
</body>

</html>